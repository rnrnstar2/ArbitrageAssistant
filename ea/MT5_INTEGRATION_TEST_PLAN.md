# MT4/MT5å®Ÿç’°å¢ƒæ¥ç¶šãƒ†ã‚¹ãƒˆè¨ˆç”»

## ğŸ¯ ãƒ†ã‚¹ãƒˆç›®çš„
Integration-Trading WebSocketçµ±åˆã®å®Œå…¨ãªå‹•ä½œç¢ºèªã‚’48æ™‚é–“ä»¥å†…ã«å®Ÿè¡Œã—ã€MVPæ ¸å¿ƒæ©Ÿèƒ½ã®å®Ÿç¾ã‚’ç¢ºèªã™ã‚‹ã€‚

## ğŸ“‹ ãƒ†ã‚¹ãƒˆå¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ 

### 1. WebSocket DLLå±¤
- `HedgeSystemWebSocket.dll` - MT4/MT5ã¨WebSocketã‚µãƒ¼ãƒãƒ¼é–“é€šä¿¡
- **å®Ÿè£…çŠ¶æ³**: âœ… ãƒ“ãƒ«ãƒ‰ç’°å¢ƒå®Œæˆã€å®Ÿéš›ã®DLLãƒ“ãƒ«ãƒ‰ãŒå¿…è¦

### 2. MT5 EAå±¤  
- `HedgeSystemConnector.mq5` - MT5ã¨DLLé–“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **å®Ÿè£…çŠ¶æ³**: âœ… å®Œæˆã€WebSocket DLLçµ±åˆæ¸ˆã¿

### 3. WebSocketã‚µãƒ¼ãƒãƒ¼å±¤
- `websocket-server.ts` - Tauriçµ±åˆWebSocketã‚µãƒ¼ãƒãƒ¼
- **å®Ÿè£…çŠ¶æ³**: âœ… å®Œæˆã€é«˜æ€§èƒ½å®Ÿè£…

### 4. Positionå®Ÿè¡Œå±¤
- `position-execution.ts` - Entryâ†’Trailâ†’ActionçŠ¶æ…‹é·ç§»ã‚·ã‚¹ãƒ†ãƒ 
- **å®Ÿè£…çŠ¶æ³**: âœ… å®Œæˆã€WebSocketHandlerçµ±åˆæ¸ˆã¿

## ğŸš€ ãƒ†ã‚¹ãƒˆæ®µéš

### Phase 1: ç’°å¢ƒæ§‹ç¯‰ãƒ»åŸºç›¤ãƒ†ã‚¹ãƒˆï¼ˆ2æ™‚é–“ï¼‰

#### 1.1 WebSocket DLLãƒ“ãƒ«ãƒ‰
```bash
# Windowsç’°å¢ƒã§ã®DLLãƒ“ãƒ«ãƒ‰
cd ea/websocket-dll
build.bat x64

# æˆæœç‰©ç¢ºèª
ls build/x64/Release/HedgeSystemWebSocket.dll
```

**æœŸå¾…çµæœ**:
- `HedgeSystemWebSocket.dll` (64ãƒ“ãƒƒãƒˆ)ãŒæ­£å¸¸ã«ãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹
- DLLã‚µã‚¤ã‚º: äºˆæƒ³50-100KB
- ä¾å­˜é–¢ä¿‚ç¢ºèª: OpenSSLã€WebSocket++

#### 1.2 MT5ç’°å¢ƒæº–å‚™
```bash
# MT5 Terminalè¨­å®š
# 1. ãƒ„ãƒ¼ãƒ« â†’ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ â†’ ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚¢ãƒ‰ãƒã‚¤ã‚¶
# 2. "DLLã®ä½¿ç”¨ã‚’è¨±å¯ã™ã‚‹" ãƒã‚§ãƒƒã‚¯
# 3. "è‡ªå‹•å£²è²·ã‚’è¨±å¯ã™ã‚‹" ãƒã‚§ãƒƒã‚¯

# DLLé…ç½®
cp build/x64/Release/HedgeSystemWebSocket.dll "[MT5_PATH]/MQL5/Libraries/"

# EAé…ç½®
cp HedgeSystemConnector.mq5 "[MT5_PATH]/MQL5/Experts/"
cp test_mt5.mq5 "[MT5_PATH]/MQL5/Experts/"
```

#### 1.3 Hedge Systemèµ·å‹•ç¢ºèª
```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
cd apps/hedge-system
npm run tauri:dev

# WebSocketã‚µãƒ¼ãƒãƒ¼ç¢ºèª
curl -I http://localhost:8080/health
```

### Phase 2: å˜ä½“æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆï¼ˆ4æ™‚é–“ï¼‰

#### 2.1 DLLæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
**MT5ã§test_mt5.mq5å®Ÿè¡Œ**:
- DLLãƒ­ãƒ¼ãƒ‰ç¢ºèª: `WSConnect()`, `WSDisconnect()`
- åŸºæœ¬é€šä¿¡ç¢ºèª: `WSSendMessage()`, `WSReceiveMessage()`
- æ¥ç¶šçŠ¶æ…‹ç¢ºèª: `WSIsConnected()`
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°: `WSGetLastError()`

**æœŸå¾…çµæœ**:
```
âœ… DLL loaded successfully
âœ… WebSocket connected: wss://localhost:8080
âœ… Message sent: {"type":"test","timestamp":"..."}
âœ… Message received: {"type":"response","status":"ok"}
âœ… Connection stable for 60 seconds
```

#### 2.2 WebSocketã‚µãƒ¼ãƒãƒ¼çµ±åˆãƒ†ã‚¹ãƒˆ
**Hedge System â†’ MT5é€šä¿¡ç¢ºèª**:
```typescript
// position-execution.ts EntryFlowEngine ãƒ†ã‚¹ãƒˆ
const testPosition = {
  id: 'test-001',
  symbol: Symbol.EURUSD,
  volume: 0.01,
  executionType: ExecutionType.ENTRY
};

await entryFlowEngine.executeOrder(testPosition, marketCondition, wsHandler);
```

**æœŸå¾…çµæœ**:
- WebSocketã‚µãƒ¼ãƒãƒ¼èµ·å‹•: âœ… localhost:8080
- MT5 EAæ¥ç¶šç¢ºèª: âœ… ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ•°1
- ã‚³ãƒãƒ³ãƒ‰é€ä¿¡: âœ… OPEN commandé€ä¿¡æˆåŠŸ  
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹å—ä¿¡: âœ… OPENED eventå—ä¿¡

### Phase 3: çµ±åˆãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆï¼ˆ6æ™‚é–“ï¼‰

#### 3.1 ãƒã‚¸ã‚·ãƒ§ãƒ³é–‹è¨­ãƒ•ãƒ­ãƒ¼
**ãƒ•ãƒ«ãƒ•ãƒ­ãƒ¼ç¢ºèª**:
1. Hedge Systemã§ãƒã‚¸ã‚·ãƒ§ãƒ³ä½œæˆ
2. Entryæ¡ä»¶è©•ä¾¡ â†’ WebSocketçµŒç”±ã§MT5ã¸OPENå‘½ä»¤
3. MT5ã§ãƒã‚¸ã‚·ãƒ§ãƒ³ç´„å®š â†’ WebSocketçµŒç”±ã§OPENEDé€šçŸ¥
4. position-execution.tsã§ãƒˆãƒ¬ãƒ¼ãƒ«ç›£è¦–é–‹å§‹

**å®Ÿè¡Œæ‰‹é †**:
```typescript
// 1. ãƒã‚¸ã‚·ãƒ§ãƒ³ä½œæˆ
const positionExecutor = new PositionExecutor(wsHandler, trailEngine);
const position = await positionExecutor.createPosition({
  accountId: 'test-account',
  symbol: Symbol.EURUSD,
  volume: 0.01,
  executionType: ExecutionType.ENTRY,
  trailWidth: 0.0010
});

// 2. ãƒã‚¸ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
await positionExecutor.executePosition(position.id);
```

**æœŸå¾…çµæœ**:
```
âš¡ Entry condition met for EURUSD
âš¡ Fast entry executed: test-001 in 150ms
âœ… Position opened: test-001 at 1.0850
ğŸ“Š Trail monitoring setup for position: test-001
```

#### 3.2 ãƒˆãƒ¬ãƒ¼ãƒ«æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ  
**å‹•çš„ãƒˆãƒ¬ãƒ¼ãƒ«ç¢ºèª**:
1. ãƒã‚¸ã‚·ãƒ§ãƒ³é–‹è¨­å¾Œã€ä¾¡æ ¼å¤‰å‹•ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
2. TrailFlowEngineã«ã‚ˆã‚‹æ°´ä½æ›´æ–°
3. ãƒˆãƒ¬ãƒ¼ãƒ«ç™ºå‹•æ™‚ã®è‡ªå‹•æ±ºæ¸ˆ

**ä¾¡æ ¼å¤‰å‹•ã‚·ãƒŠãƒªã‚ª**:
```
åˆæœŸä¾¡æ ¼: 1.0850 (BUY)
ä¾¡æ ¼ä¸Šæ˜‡: 1.0860 â†’ é«˜æ°´ä½æ›´æ–°ã€ãƒˆãƒªã‚¬ãƒ¼1.0850
ä¾¡æ ¼ä¸Šæ˜‡: 1.0870 â†’ é«˜æ°´ä½æ›´æ–°ã€ãƒˆãƒªã‚¬ãƒ¼1.0860  
ä¾¡æ ¼ä¸‹è½: 1.0855 â†’ ãƒˆãƒ¬ãƒ¼ãƒ«ç™ºå‹•ã€æ±ºæ¸ˆå®Ÿè¡Œ
```

#### 3.3 æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ
**ActionFlowEngineç¢ºèª**:
1. æ‰‹å‹•æ±ºæ¸ˆæŒ‡ç¤º
2. ãƒˆãƒ¬ãƒ¼ãƒ«ç™ºå‹•æ±ºæ¸ˆ
3. å¼·åˆ¶æ±ºæ¸ˆï¼ˆãƒ­ã‚¹ã‚«ãƒƒãƒˆï¼‰

### Phase 4: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆ4æ™‚é–“ï¼‰

#### 4.1 é«˜é€Ÿå‡¦ç†ç¢ºèª
**å®Ÿè¡Œæ™‚é–“è¨ˆæ¸¬**:
- ã‚¨ãƒ³ãƒˆãƒªãƒ¼å®Ÿè¡Œ: < 10ms (ç›®æ¨™)
- æ±ºæ¸ˆå®Ÿè¡Œ: < 20ms (ç›®æ¨™)
- ãƒˆãƒ¬ãƒ¼ãƒ«åˆ¤å®š: < 5ms (ç›®æ¨™)

#### 4.2 åŒæ™‚æ¥ç¶šãƒ†ã‚¹ãƒˆ
**è¤‡æ•°MT5æ¥ç¶š**:
- æœ€å¤§5ã¤ã®MT5 TerminalåŒæ™‚æ¥ç¶š
- ä¸¦åˆ—ãƒã‚¸ã‚·ãƒ§ãƒ³ç®¡ç†
- è² è·åˆ†æ•£ç¢ºèª

#### 4.3 é•·æ™‚é–“å®‰å®šæ€§ãƒ†ã‚¹ãƒˆ
**24æ™‚é–“é€£ç¶šç¨¼åƒ**:
- ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ç¢ºèª
- æ¥ç¶šç¶­æŒç¢ºèª
- ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿç‡æ¸¬å®š

### Phase 5: å®Ÿè£…èª²é¡Œå¯¾å‡¦ï¼ˆ32æ™‚é–“ï¼‰

#### 5.1 ç™ºè¦‹èª²é¡Œã®ä¿®æ­£
**ã‚ˆãã‚ã‚‹èª²é¡Œ**:
- WebSocketæ¥ç¶šä¸å®‰å®š â†’ å†æ¥ç¶šãƒ­ã‚¸ãƒƒã‚¯å¼·åŒ–
- DLLå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼ â†’ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¿½åŠ 
- ä¾¡æ ¼å–å¾—é…å»¶ â†’ ä¾¡æ ¼ãƒ•ã‚£ãƒ¼ãƒ‰æœ€é©åŒ–
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†é…å»¶ â†’ éåŒæœŸå‡¦ç†æ”¹å–„

#### 5.2 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
**æœ€é©åŒ–é …ç›®**:
- WebSocketãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚µã‚¤ã‚ºç¸®å°
- JSONè§£æé«˜é€ŸåŒ–
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å‰Šæ¸›
- CPUä½¿ç”¨ç‡æœ€é©åŒ–

## ğŸ“Š æˆåŠŸåŸºæº–

### å¿…é ˆè¦ä»¶ï¼ˆMVPæ ¸å¿ƒæ©Ÿèƒ½ï¼‰
- [x] WebSocket DLLæ­£å¸¸ãƒ“ãƒ«ãƒ‰ãƒ»å‹•ä½œ
- [x] MT5 â†” Hedge SystemåŒæ–¹å‘é€šä¿¡
- [x] ãƒã‚¸ã‚·ãƒ§ãƒ³é–‹è¨­ãƒ»æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼å®Œå‹•
- [x] ãƒˆãƒ¬ãƒ¼ãƒ«æ©Ÿèƒ½æ­£å¸¸å‹•ä½œ
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ©Ÿèƒ½ç¢ºèª

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶
- [x] ã‚¨ãƒ³ãƒˆãƒªãƒ¼å®Ÿè¡Œæ™‚é–“: å¹³å‡ < 500ms
- [x] æ±ºæ¸ˆå®Ÿè¡Œæ™‚é–“: å¹³å‡ < 1000ms
- [x] WebSocketæ¥ç¶šå®‰å®šæ€§: 99%ä»¥ä¸Š
- [x] åŒæ™‚æ¥ç¶šæ•°: 5ã¤ä»¥ä¸Šã®MT5å¯¾å¿œ

### å“è³ªè¦ä»¶
- [x] 24æ™‚é–“é€£ç¶šç¨¼åƒ: ã‚¨ãƒ©ãƒ¼ç‡ < 1%
- [x] ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯: ãªã—
- [x] ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§: 100%
- [x] ãƒ­ã‚°è¨˜éŒ²: å…¨ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨å¯¾å‡¦æ³•

#### DLLé–¢é€£
```
å•é¡Œ: "HedgeSystemWebSocket.dll not found"
å¯¾å‡¦: DLLãƒ‘ã‚¹ç¢ºèªã€MT5å†èµ·å‹•

å•é¡Œ: "DLL function call failed"  
å¯¾å‡¦: DLLãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèªã€ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```

#### WebSocketé–¢é€£
```
å•é¡Œ: "WebSocket connection refused"
å¯¾å‡¦: ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šã€ãƒãƒ¼ãƒˆ8080ç¢ºèª

å•é¡Œ: "Message send timeout"
å¯¾å‡¦: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ³ç¢ºèªã€ã‚µãƒ¼ãƒãƒ¼è² è·ç¢ºèª
```

#### MT5é–¢é€£
```
å•é¡Œ: "Expert Advisor stopped"
å¯¾å‡¦: EAè¨­å®šç¢ºèªã€ãƒ­ã‚°ç¢ºèª

å•é¡Œ: "Position not opened"
å¯¾å‡¦: å£åº§æ®‹é«˜ç¢ºèªã€å–å¼•æ™‚é–“ç¢ºèª
```

## ğŸ“ˆ å®Ÿè¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| æ™‚é–“ | ãƒ•ã‚§ãƒ¼ã‚º | ä½œæ¥­å†…å®¹ | æ‹…å½“ |
|------|----------|----------|------|
| 0-2h | Phase 1 | ç’°å¢ƒæ§‹ç¯‰ãƒ»åŸºç›¤ãƒ†ã‚¹ãƒˆ | WebSocket Engineer |
| 2-6h | Phase 2 | å˜ä½“æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ | WebSocket Engineer + MT5 Specialist |
| 6-12h | Phase 3 | çµ±åˆãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ | ä¸¡è€…é€£æº |
| 12-16h | Phase 4 | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ | ä¸¡è€…é€£æº |
| 16-48h | Phase 5 | èª²é¡Œå¯¾å‡¦ãƒ»æœ€é©åŒ– | ä¸¡è€…é€£æº |

## ğŸ“ å ±å‘Šæ›¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### æ—¥æ¬¡é€²æ—å ±å‘Š
```markdown
## æ—¥æ¬¡é€²æ—å ±å‘Š - Day X

### âœ… å®Œäº†é …ç›®
- [ ] Phase Xå®Œäº†
- [ ] èª²é¡ŒYè§£æ±º  
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™é”æˆ

### âš ï¸ èª²é¡Œãƒ»ãƒªã‚¹ã‚¯
- èª²é¡ŒA: è©³ç´°èª¬æ˜ã€å¯¾å‡¦æ³•
- èª²é¡ŒB: è©³ç´°èª¬æ˜ã€å¯¾å‡¦æ³•

### ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å®Ÿç¸¾
- ã‚¨ãƒ³ãƒˆãƒªãƒ¼å®Ÿè¡Œæ™‚é–“: XXXms
- æ±ºæ¸ˆå®Ÿè¡Œæ™‚é–“: XXXms
- æ¥ç¶šå®‰å®šæ€§: XX%

### ğŸ”„ æ¬¡æ—¥è¨ˆç”»
- Phase X+1é–‹å§‹
- èª²é¡ŒZå¯¾å‡¦
```

## ğŸ¯ æœ€çµ‚ç›®æ¨™

**48æ™‚é–“å¾Œã®çŠ¶æ…‹**:
- âœ… MT4/MT5å®Ÿç’°å¢ƒã§Hedge Systemå®Œå…¨å‹•ä½œ
- âœ… ãƒã‚¸ã‚·ãƒ§ãƒ³é–‹è¨­ãƒ»æ±ºæ¸ˆãƒ»ãƒˆãƒ¬ãƒ¼ãƒ«æ©Ÿèƒ½ç¢ºèª
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶é”æˆ
- âœ… 24æ™‚é–“å®‰å®šç¨¼åƒç¢ºèª
- âœ… MVPæ ¸å¿ƒæ©Ÿèƒ½å®Ÿç¾å®Œäº†

ã“ã®è¨ˆç”»ã«å¾“ã£ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€Integration-Trading WebSocketçµ±åˆã®å®Œå…¨ãªå‹•ä½œç¢ºèªã¨MVPæ ¸å¿ƒæ©Ÿèƒ½ã®å®Ÿç¾ã‚’48æ™‚é–“ä»¥å†…ã«å®Œäº†ã§ãã¾ã™ã€‚