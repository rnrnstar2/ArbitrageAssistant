# Task 02: ポジション決済システムの実装

## 概要
決済価格指定による手動決済機能と日次ポジション整理機能を実装する。スワップコスト回避のための重要な機能。

## 実装範囲

### 1. 決済フォーム機能
- **個別決済**
  - ポジション選択
  - 決済価格指定（成行/指値）
  - 部分決済対応
  - 決済実行

- **一括決済**
  - 複数ポジション選択
  - 条件指定決済
  - 通貨ペア別一括決済

### 2. 日次ポジション整理
- **スワップコスト回避**
  - 日次での自動ポジション整理提案
  - 同一通貨ペアの決済・再エントリー
  - 取引履歴の継続性維持

### 3. 関連ポジション連動決済
- **両建てポジション管理**
  - 関連ポジションの自動検出
  - 連動決済設定
  - 片方決済時の対応設定

## 参考ファイル
- `apps/admin/features/trading/close/`
- `apps/admin/features/trading/analysis/daily-close-summary.tsx`
- `apps/hedge-system/src/features/monitoring/ActivePositions.tsx`

## 実装手順

### Phase 1: 決済フォームUI
1. `src/features/trading/close/` ディレクトリ作成
2. `CloseForm.tsx` - 個別決済フォーム
3. `BatchCloseForm.tsx` - 一括決済フォーム
4. `PositionSelector.tsx` - ポジション選択コンポーネント

### Phase 2: 決済ロジック実装
5. WebSocket経由の決済コマンド送信
6. 決済結果の受信・処理
7. 部分決済の計算・実行

### Phase 3: 日次整理機能
8. `DailyCloseManager.tsx` - 日次整理管理
9. スワップコスト計算機能
10. 整理提案ロジック

### Phase 4: 連動決済機能
11. 関連ポジション検出ロジック
12. 連動決済設定UI
13. 自動実行機能

## 完了条件
- [ ] 個別ポジション決済機能
- [ ] 一括決済機能
- [ ] 日次ポジション整理機能
- [ ] 関連ポジション連動決済
- [ ] 決済履歴の記録・表示
- [ ] エラーハンドリング

## 注意事項
- 決済前の確認ダイアログ必須
- 決済不可状態の適切な表示
- 取引履歴の継続性維持
- 両建てポジションの整合性チェック